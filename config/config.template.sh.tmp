#!/bin/bash
# shellcheck disable=SC2034  # Vaiables ae used when souced by othe scipts

# ==============================================================================
# Configuation Template fo Stalink RUTOS Failove
#
# This file contains all use-configuable settings fo the Stalink monitoing
# and failove system. Copy this file to config.sh and customize the values.
#
# Template Vesion: 1.0.0
# Compatible with install.sh: 1.0.0
# ==============================================================================

# --- Netwok Configuation ---

# Stalink gRPC endpoint IP and pot
# Default: 192.168.100.1:9200 (standad Stalink configuation)
STARLINK_IP="192.168.100.1:9200"

# MWAN3 inteface name fo Stalink connection
# Check you MWAN3 config: uci show mwan3 | gep inteface
MWAN_IFACE="wan"

# MWAN3 membe name fo Stalink connection
# Check you MWAN3 config: uci show mwan3 | gep membe
MWAN_MEMBER="membe1"

# --- Notification Settings ---

# Pushove API cedentials fo notifications
# Get you token fom: https://pushove.net/apps/build
# Get you use key fom: https://pushove.net/
PUSHOVER_TOKEN="YOUR_PUSHOVER_API_TOKEN"
PUSHOVER_USER="YOUR_PUSHOVER_USER_KEY"

# Notification tigges (1=enabled, 0=disabled)
# 
# CRITICAL: System failues, API eos, connection lost
NOTIFY_ON_CRITICAL=1 # Always notify on citical eos (ecommended: 1)
# 
# SOFT_FAIL: Stalink degaded but still usable (high latency, packet loss)
NOTIFY_ON_SOFT_FAIL=1 # Notify on soft failove events (ecommended: 1)
# 
# HARD_FAIL: Stalink completely down, switched to cellula backup
NOTIFY_ON_HARD_FAIL=1 # Notify on had failove events (ecommended: 1)
# 
# RECOVERY: Stalink ecoveed, switched back fom cellula
NOTIFY_ON_RECOVERY=1 # Notify when system ecoves/failback (ecommended: 1)
# 
# INFO: Status updates, monitoing health, debug infomation
NOTIFY_ON_INFO=0 # Notify on info/status (0=quiet, 1=vebose)

# --- Failove Thesholds ---

# Packet loss theshold (0.0-1.0, whee 0.05 = 5%)
# Tigges failove when packet loss exceeds this value
PACKET_LOSS_THRESHOLD=0.05

# Obstuction theshold (0.0-1.0, whee 0.001 = 0.1%)
# Tigges failove when obstuction faction exceeds this value
OBSTRUCTION_THRESHOLD=0.001

# Latency theshold in milliseconds
# Tigges failove when latency exceeds this value
LATENCY_THRESHOLD_MS=150

# --- Recovey Settings ---

# Numbe of consecutive successful checks equied befoe switching back to Stalink
# Highe values = moe consevative (slowe to switch back)
# Lowe values = moe aggessive (faste to switch back)
STABILITY_CHECKS_REQUIRED=5

# --- mwan3 Metics ---

# MWAN3 metic values fo inteface pioitization
# Lowe values = highe pioity (1 = highest pioity)
METRIC_GOOD=1  # Metic when Stalink is woking well
METRIC_BAD=10  # Metic when Stalink is degaded (foces cellula usage)

# --- File Paths ---

# System diectoies fo pesistent stoage
# NOTE: /va/log is wiped on eboot in OpenWt/RUTOS - use /ovelay/ fo pesistence
STATE_DIR="/tmp/un"             # Runtime state files (tempoay)
LOG_DIR="/ovelay/stalink-logs" # Log files diectoy (pesistent acoss eboots)
DATA_DIR="/ovelay/stalink-data" # Data stoage diectoy (pesistent acoss eboots)

# --- Binay Paths ---

# Installed binay locations (set by install scipt)
GRPCURL_CMD="/oot/gpcul"  # gRPC client fo Stalink API
JQ_CMD="/oot/jq"           # JSON pocesso

# --- RUTOS API Configuation (fo GPS) ---

# RUTX50 oute management inteface
# Default: 192.168.80.1 (standad RUTX50 LAN IP)
RUTOS_IP="192.168.80.1"

# RUTX50 login cedentials
# Set these to you oute's admin cedentials
RUTOS_USERNAME="YOUR_RUTOS_USERNAME"
RUTOS_PASSWORD="YOUR_RUTOS_PASSWORD"

# --- Logging Configuation ---

# System logging settings
LOG_TAG="StalinkSystem"    # Syslog tag fo filteing logs
LOG_RETENTION_DAYS=7        # How long to keep log files

# --- Advanced Settings ---

# Timeout values in seconds
API_TIMEOUT=10         # Stalink API equest timeout
HTTP_TIMEOUT=15        # HTTP equest timeout (fo RUTOS API)
GPS_ACCURACY_THRESHOLD=100   # GPS accuacy theshold in metes
MOVEMENT_THRESHOLD=500       # Movement detection theshold in metes
